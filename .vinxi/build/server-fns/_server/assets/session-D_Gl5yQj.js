import{c as n}from"./server-fns-runtime-HUGH5Jm0.js";import{e as i,g as u,f as d,s as m}from"./fetchEvent-CIpVWTXg.js";import{db as c}from"./index-BinUX9hy.js";import{s as r}from"./schema-DxiP6MVG.js";import{eq as g}from"drizzle-orm";import"solid-js/web";import"solid-js/web/storage";import"h3";import"unctx";import"node:async_hooks";import"drizzle-orm/postgres-js";import"postgres";import"drizzle-orm/pg-core";const t="session",p=n(async function(){try{let e;try{e=i()}catch{return null}const s=u(e,t);if(console.log(`[Session] getUser found cookie: ${s?"YES":"NO"} (${s})`),!s)return null;const o=await c.query.sessions.findFirst({where:g(r.id,s)});return o?o.expiresAt<new Date?(console.log("[Session] Session expired"),await _(),null):o.userId:(console.log("[Session] Session not found in DB"),null)}catch(e){return console.error("Error getting session cookie:",e),null}},"src_lib_session_ts--getUser_1","/Users/dedirosandi/Documents/PROJECT/program-ela/src/lib/session.ts?tsr-directive-use-server="),A=p,S=n(async function(e){console.log(`[Session] Creating session for user: ${e}`);try{const s=i(),o=crypto.randomUUID(),l=new Date(Date.now()+1e3*60*60*24*30);await c.insert(r).values({id:o,userId:e,expiresAt:l}),m(s,t,o,{httpOnly:!0,secure:!0,maxAge:3600*24*30,path:"/",sameSite:"lax"}),console.log("[Session] Session created and cookie set")}catch(s){throw console.error("Error creating session:",s),s}},"src_lib_session_ts--createUserSession_1","/Users/dedirosandi/Documents/PROJECT/program-ela/src/lib/session.ts?tsr-directive-use-server="),R=S,f=n(async function(){console.log("Logging out user...");try{const e=i(),s=u(e,t);s&&await c.delete(r).where(g(r.id,s)),d(e,t,{path:"/"}),console.log("Session cookie deleted.")}catch(e){console.error("Error during logout:",e)}return{success:!0}},"src_lib_session_ts--logout_1","/Users/dedirosandi/Documents/PROJECT/program-ela/src/lib/session.ts?tsr-directive-use-server="),_=f;export{R as createUserSession,A as getUser,_ as logout};
