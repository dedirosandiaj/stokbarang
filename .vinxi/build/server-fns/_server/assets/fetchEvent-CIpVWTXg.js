import{H3Event as a,deleteCookie as C,setResponseStatus as k,setHeader as q,setCookie as v,appendResponseHeader as A,getRequestIP as T,parseCookies as $,getResponseStatus as E,getResponseStatusText as _,getResponseHeader as w,setResponseHeader as P,removeResponseHeader as j,getResponseHeaders as O,getRequestURL as W,getRequestWebStream as L,getCookie as F}from"h3";import{getContext as U}from"unctx";import{AsyncLocalStorage as I}from"node:async_hooks";function M(e){let t;const s=f(e),o={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(s,{...o,body:e.node.req.body}):new Request(s,{...o,get body(){return t||(t=m(e),t)}})}function l(e){return e.web??={request:M(e),url:f(e)},e.web.request}function N(){return x()}const d=Symbol("$HTTPEvent");function R(e){return typeof e=="object"&&(e instanceof a||e?.[d]instanceof a||e?.__is_event__===!0)}function n(e){return function(...t){let s=t[0];if(R(s))t[0]=s instanceof a||s.__is_event__?s:s[d];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(s=N(),!s)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");t.unshift(s)}return e(...t)}}const f=n(W),y=n(T),u=n(k),c=n(E),h=n(_),r=n(O),p=n(w),b=n(P),g=n(A),z=n($),B=n(F),D=n(v),G=n(C),J=n(q),m=n(L),H=n(j),S=n(l);function K(){return U("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:I})}function x(){return K().use().event}const te=Object.freeze(Object.defineProperty({__proto__:null,H3Event:a,HTTPEventSymbol:d,appendResponseHeader:g,deleteCookie:G,eventHandler,getCookie:B,getEvent:x,getRequestIP:y,getRequestURL:f,getRequestWebStream:m,getResponseHeader:p,getResponseHeaders:r,getResponseStatus:c,getResponseStatusText:h,getWebRequest:S,isEvent:R,parseCookies:z,removeResponseHeader:H,setCookie:D,setHeader:J,setResponseHeader:b,setResponseStatus:u,toWebRequest:l},Symbol.toStringTag,{value:"Module"})),i="solidFetchEvent";function Q(e){return{request:S(e),response:X(e),clientAddress:y(e),locals:{},nativeEvent:e}}function se(e){return{...e}}function ne(e){if(!e.context[i]){const t=Q(e);e.context[i]=t}return e.context[i]}function oe(e,t){for(const[s,o]of t.entries())g(e,s,o)}class V{event;constructor(t){this.event=t}get(t){const s=p(this.event,t);return Array.isArray(s)?s.join(", "):s||null}has(t){return this.get(t)!==null}set(t,s){return b(this.event,t,s)}delete(t){return H(this.event,t)}append(t,s){g(this.event,t,s)}getSetCookie(){const t=p(this.event,"Set-Cookie");return Array.isArray(t)?t:[t]}forEach(t){return Object.entries(r(this.event)).forEach(([s,o])=>t(Array.isArray(o)?o.join(", "):o,s,this))}entries(){return Object.entries(r(this.event)).map(([t,s])=>[t,Array.isArray(s)?s.join(", "):s])[Symbol.iterator]()}keys(){return Object.keys(r(this.event))[Symbol.iterator]()}values(){return Object.values(r(this.event)).map(t=>Array.isArray(t)?t.join(", "):t)[Symbol.iterator]()}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}}function X(e){return{get status(){return c(e)},set status(t){u(e,t)},get statusText(){return h(e)},set statusText(t){u(e,c(e),t)},headers:new V(e)}}export{ne as a,u as b,J as c,se as d,x as e,G as f,B as g,te as h,oe as m,z as p,D as s};
