import{H3Event as a,deleteCookie as C,sendRedirect as q,setResponseStatus as v,setHeader as A,getRequestIP as T,getResponseStatus as $,getResponseStatusText as E,getResponseHeader as k,setResponseHeader as _,removeResponseHeader as w,appendResponseHeader as P,getResponseHeaders as j,getRequestURL as O,getRequestWebStream as W,setCookie as L,getCookie as F}from"h3";import{getContext as U}from"unctx";import{AsyncLocalStorage as I}from"node:async_hooks";function M(e){let t;const s=f(e),r={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(s,{...r,body:e.node.req.body}):new Request(s,{...r,get body(){return t||(t=m(e),t)}})}function g(e){return e.web??={request:M(e),url:f(e)},e.web.request}function N(){return x()}const d=Symbol("$HTTPEvent");function R(e){return typeof e=="object"&&(e instanceof a||e?.[d]instanceof a||e?.__is_event__===!0)}function n(e){return function(...t){let s=t[0];if(R(s))t[0]=s instanceof a||s.__is_event__?s:s[d];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(s=N(),!s)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");t.unshift(s)}return e(...t)}}const f=n(O),l=n(T),c=n(v),u=n($),h=n(E),o=n(j),p=n(k),y=n(_),b=n(P),z=n(q),B=n(F),D=n(L),G=n(C),J=n(A),m=n(W),S=n(w),H=n(g);function K(){return U("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:I})}function x(){return K().use().event}const te=Object.freeze(Object.defineProperty({__proto__:null,H3Event:a,HTTPEventSymbol:d,appendResponseHeader:b,deleteCookie:G,eventHandler,getCookie:B,getEvent:x,getRequestIP:l,getRequestURL:f,getRequestWebStream:m,getResponseHeader:p,getResponseHeaders:o,getResponseStatus:u,getResponseStatusText:h,getWebRequest:H,isEvent:R,removeResponseHeader:S,sendRedirect:z,setCookie:D,setHeader:J,setResponseHeader:y,setResponseStatus:c,toWebRequest:g},Symbol.toStringTag,{value:"Module"})),i="solidFetchEvent";function Q(e){return{request:H(e),response:X(e),clientAddress:l(e),locals:{},nativeEvent:e}}function se(e){return{...e}}function ne(e){if(!e.context[i]){const t=Q(e);e.context[i]=t}return e.context[i]}class V{event;constructor(t){this.event=t}get(t){const s=p(this.event,t);return Array.isArray(s)?s.join(", "):s||null}has(t){return this.get(t)!==null}set(t,s){return y(this.event,t,s)}delete(t){return S(this.event,t)}append(t,s){b(this.event,t,s)}getSetCookie(){const t=p(this.event,"Set-Cookie");return Array.isArray(t)?t:[t]}forEach(t){return Object.entries(o(this.event)).forEach(([s,r])=>t(Array.isArray(r)?r.join(", "):r,s,this))}entries(){return Object.entries(o(this.event)).map(([t,s])=>[t,Array.isArray(s)?s.join(", "):s])[Symbol.iterator]()}keys(){return Object.keys(o(this.event))[Symbol.iterator]()}values(){return Object.values(o(this.event)).map(t=>Array.isArray(t)?t.join(", "):t)[Symbol.iterator]()}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}}function X(e){return{get status(){return u(e)},set status(t){c(e,t)},get statusText(){return h(e)},set statusText(t){c(e,u(e),t)},headers:new V(e)}}export{ne as a,z as b,c,J as d,se as e,x as f,B as g,G as h,te as i,D as s};
