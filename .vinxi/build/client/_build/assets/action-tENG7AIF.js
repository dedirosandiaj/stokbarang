import{B as R,C as D,f as T,s as C,e as S,g as _,D as L,a as $,$ as B}from"./web-B77D8VL7.js";import{u as M,g as I,h as K,i as j,m as k}from"./routing-D8yMn4L8.js";const x="Location",U=5e3,X=18e4;let m=new Map;setInterval(()=>{const e=Date.now();for(let[t,n]of m.entries())!n[4].count&&e-n[0]>X&&m.delete(t)},3e5);function p(){return m}function H(e,t=!0){return R(()=>{const n=Date.now();A(e,s=>{t&&(s[0]=0),s[4][1](n)})})}function A(e,t){e&&!Array.isArray(e)&&(e=[e]);for(let n of m.keys())(e===void 0||W(n,e))&&t(m.get(n))}function y(e,t){e.GET&&(e=e.GET);const n=(...s)=>{const r=p(),i=I(),u=K(),b=_()?M():void 0,d=Date.now(),g=t+P(s);let o=r.get(g),w;if(D()&&!L&&(w=!0,T(()=>o[4].count--)),o&&o[0]&&(i==="native"||o[4].count||Date.now()-o[0]<U)){w&&(o[4].count++,o[4][0]()),o[3]==="preload"&&i!=="preload"&&(o[0]=d);let a=o[1];return i!=="preload"&&(a="then"in o[1]?o[1].then(h(!1),h(!0)):h(!1)(o[1]),i==="navigate"&&R(()=>o[4][1](o[0]))),u&&"then"in a&&a.catch(()=>{}),a}let c;return C.has&&C.has(g)?(c=C.load(g),delete globalThis._$HY.r[g]):c=e(...s),o?(o[0]=d,o[1]=c,o[3]=i,i==="navigate"&&R(()=>o[4][1](o[0]))):(r.set(g,o=[d,c,,i,S(d)]),o[4].count=0),w&&(o[4].count++,o[4][0]()),i!=="preload"&&(c="then"in c?c.then(h(!1),h(!0)):h(!1)(c)),u&&"then"in c&&c.catch(()=>{}),c;function h(a){return async l=>{if(l instanceof Response){const O=l.headers.get(x);if(O!==null){b&&O.startsWith("/")?R(()=>{b(O,{replace:!0})}):window.location.href=O;return}l.customBody&&(l=await l.customBody())}if(a)throw l;return o[2]=l,l}}};return n.keyFor=(...s)=>t+P(s),n.key=t,n}y.get=e=>p().get(e)[2];y.set=(e,t)=>{const n=p(),s=Date.now();let r=n.get(e);r?(r[0]=s,r[1]=Promise.resolve(t),r[2]=t,r[3]="preload"):(n.set(e,r=[s,Promise.resolve(t),t,"preload",S(s)]),r[4].count=0)};y.delete=e=>p().delete(e);y.clear=()=>p().clear();function W(e,t){for(let n of t)if(n&&e.startsWith(n))return!0;return!1}function P(e){return JSON.stringify(e,(t,n)=>v(n)?Object.keys(n).sort().reduce((s,r)=>(s[r]=n[r],s),{}):n)}function v(e){let t;return e!=null&&typeof e=="object"&&(!(t=Object.getPrototypeOf(e))||t===Object.prototype)}const F=new Map;function G(e,t){const n=j(),s=$(()=>n.submissions[0]().filter(r=>r.url===e.base&&!0));return new Proxy([],{get(r,i){return i===B?s():i==="pending"?s().some(u=>!u.result):s()[i]},has(r,i){return i in s()}})}function z(e,t){const n=G(e);return new Proxy({},{get(s,r){return n.length===0&&r==="clear"||r==="retry"?()=>{}:n[n.length-1]?.[r]}})}function Q(e,t={}){function n(...i){const u=this.r,f=this.f,b=(u.singleFlight&&e.withOptions?e.withOptions({headers:{"X-Single-Flight":"true"}}):e)(...i),[d,g]=S();let o;function w(c){return async h=>{const a=await q(h,c,u.navigatorFactory());let l=null;if(s.onComplete?.({...o,result:a?.data,error:a?.error,pending:!1,retry(){return l=o.retry()}}),l)return l;if(!a)return o.clear();if(g(a),a.error&&!f)throw a.error;return a.data}}return u.submissions[1](c=>[...c,o={input:i,url:r,get result(){return d()?.data},get error(){return d()?.error},get pending(){return!d()},clear(){u.submissions[1](h=>h.filter(a=>a!==o))},retry(){return g(void 0),e(...i).then(w(),w(!0))}}]),b.then(w(),w(!0))}const s=typeof t=="string"?{name:t}:t,r=e.url||s.name&&`https://action/${s.name}`||`https://action/${N(e.toString())}`;return n.base=r,E(n,r)}function E(e,t){return e.toString=()=>{if(!t)throw new Error("Client Actions need explicit names if server rendered");return t},e.with=function(...n){const s=function(...i){return e.call(this,...n,...i)};s.base=e.base;const r=new URL(t,k);return r.searchParams.set("args",P(n)),E(s,(r.origin==="https://action"?r.origin:"")+r.pathname+r.search)},e.url=t,F.set(t,e),_()&&T(()=>F.delete(t)),e}const N=e=>e.split("").reduce((t,n)=>(t<<5)-t+n.charCodeAt(0)|0,0);async function q(e,t,n){let s,r,i,u;if(e instanceof Response){if(e.headers.has("X-Revalidate")&&(i=e.headers.get("X-Revalidate").split(",")),e.customBody&&(s=r=await e.customBody(),e.headers.has("X-Single-Flight")&&(s=s._$value,delete r._$value,u=Object.keys(r))),e.headers.has("Location")){const f=e.headers.get("Location")||"/";f.startsWith("http")?window.location.href=f:n(f)}}else{if(t)return{error:e};s=e}return A(i,f=>f[0]=0),u&&u.forEach(f=>y.set(f,r[f])),await H(i,!1),s!=null?{data:s}:void 0}export{F as a,Q as b,z as u};
