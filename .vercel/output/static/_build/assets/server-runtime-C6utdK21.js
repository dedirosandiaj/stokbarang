var fe=(e=>(e[e.AggregateError=1]="AggregateError",e[e.ArrowFunction=2]="ArrowFunction",e[e.ErrorPrototypeStack=4]="ErrorPrototypeStack",e[e.ObjectAssign=8]="ObjectAssign",e[e.BigIntTypedArray=16]="BigIntTypedArray",e[e.RegExp=32]="RegExp",e))(fe||{}),g=Symbol.asyncIterator,pe=Symbol.hasInstance,x=Symbol.isConcatSpreadable,E=Symbol.iterator,de=Symbol.match,ye=Symbol.matchAll,he=Symbol.replace,be=Symbol.search,we=Symbol.species,me=Symbol.split,ve=Symbol.toPrimitive,A=Symbol.toStringTag,ge=Symbol.unscopables,W={[g]:0,[pe]:1,[x]:2,[E]:3,[de]:4,[ye]:5,[he]:6,[be]:7,[we]:8,[me]:9,[ve]:10,[A]:11,[ge]:12},t=void 0,Ee={0:"Error",1:"EvalError",2:"RangeError",3:"ReferenceError",4:"SyntaxError",5:"TypeError",6:"URIError"};function c(e,r,n,a,s,i,u,l,o,p,d,y){return{t:e,i:r,s:n,c:a,m:s,p:i,e:u,a:l,f:o,b:p,o:d,l:y}}function w(e){return c(2,t,e,t,t,t,t,t,t,t,t,t)}var Q=w(2),K=w(3),ze=w(1),Re=w(0),Se=w(4),xe=w(5),Ae=w(6),Ue=w(7);function $e(e){switch(e){case'"':return'\\"';case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"\b":return"\\b";case"	":return"\\t";case"\f":return"\\f";case"<":return"\\x3C";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return t}}function m(e){let r="",n=0,a;for(let s=0,i=e.length;s<i;s++)a=$e(e[s]),a&&(r+=e.slice(n,s)+a,n=s+1);return n===0?r=e:r+=e.slice(n),r}var z="__SEROVAL_REFS__",Z=new Map,R=new Map;function ee(e){return Z.has(e)}function Oe(e){if(ee(e))return Z.get(e);throw new ar(e)}typeof globalThis<"u"?Object.defineProperty(globalThis,z,{value:R,configurable:!0,writable:!1,enumerable:!1}):typeof window<"u"?Object.defineProperty(window,z,{value:R,configurable:!0,writable:!1,enumerable:!1}):typeof self<"u"?Object.defineProperty(self,z,{value:R,configurable:!0,writable:!1,enumerable:!1}):typeof global<"u"&&Object.defineProperty(global,z,{value:R,configurable:!0,writable:!1,enumerable:!1});function k(e){return e instanceof EvalError?1:e instanceof RangeError?2:e instanceof ReferenceError?3:e instanceof SyntaxError?4:e instanceof TypeError?5:e instanceof URIError?6:0}function _e(e){let r=Ee[k(e)];return e.name!==r?{name:e.name}:e.constructor.name!==r?{name:e.constructor.name}:{}}function re(e,r){let n=_e(e),a=Object.getOwnPropertyNames(e);for(let s=0,i=a.length,u;s<i;s++)u=a[s],u!=="name"&&u!=="message"&&(u==="stack"?r&4&&(n=n||{},n[u]=e[u]):(n=n||{},n[u]=e[u]));return n}function te(e){return Object.isFrozen(e)?3:Object.isSealed(e)?2:Object.isExtensible(e)?0:1}function Ce(e){switch(e){case Number.POSITIVE_INFINITY:return xe;case Number.NEGATIVE_INFINITY:return Ae}return e!==e?Ue:Object.is(e,-0)?Se:c(0,t,e,t,t,t,t,t,t,t,t,t)}function ne(e){return c(1,t,m(e),t,t,t,t,t,t,t,t,t)}function Ie(e){return c(3,t,""+e,t,t,t,t,t,t,t,t,t)}function Pe(e){return c(4,e,t,t,t,t,t,t,t,t,t,t)}function Te(e,r){let n=r.valueOf();return c(5,e,n!==n?"":r.toISOString(),t,t,t,t,t,t,t,t,t)}function Fe(e,r){return c(6,e,t,m(r.source),r.flags,t,t,t,t,t,t,t)}function Le(e,r){return c(17,e,W[r],t,t,t,t,t,t,t,t,t)}function ke(e,r){return c(18,e,m(Oe(r)),t,t,t,t,t,t,t,t,t)}function Ne(e,r,n){return c(25,e,n,m(r),t,t,t,t,t,t,t,t)}function je(e,r,n){return c(9,e,t,t,t,t,t,n,t,t,te(r),t)}function Me(e,r){return c(21,e,t,t,t,t,t,t,r,t,t,t)}function De(e,r,n){return c(15,e,t,r.constructor.name,t,t,t,t,n,r.byteOffset,t,r.length)}function Be(e,r,n){return c(16,e,t,r.constructor.name,t,t,t,t,n,r.byteOffset,t,r.byteLength)}function Ve(e,r,n){return c(20,e,t,t,t,t,t,t,n,r.byteOffset,t,r.byteLength)}function qe(e,r,n){return c(13,e,k(r),t,m(r.message),n,t,t,t,t,t,t)}function Xe(e,r,n){return c(14,e,k(r),t,m(r.message),n,t,t,t,t,t,t)}function Ge(e,r){return c(7,e,t,t,t,t,t,r,t,t,t,t)}function Ye(e,r){return c(28,t,t,t,t,t,t,[e,r],t,t,t,t)}function He(e,r){return c(30,t,t,t,t,t,t,[e,r],t,t,t,t)}function Je(e,r,n){return c(31,e,t,t,t,t,t,n,r,t,t,t)}function We(e,r){return c(32,e,t,t,t,t,t,t,r,t,t,t)}function Qe(e,r){return c(33,e,t,t,t,t,t,t,r,t,t,t)}function Ke(e,r){return c(34,e,t,t,t,t,t,t,r,t,t,t)}function Ze(e,r,n,a){return c(35,e,n,t,t,t,t,r,t,t,t,a)}var er={parsing:1,serialization:2,deserialization:3};function rr(e){return`Seroval Error (step: ${er[e]})`}var tr=(e,r)=>rr(e),nr=class extends Error{constructor(e,r){super(tr(e)),this.cause=r}},V=class extends nr{constructor(e){super("parsing",e)}};function ae(e){return`Seroval Error (specific: ${e})`}var $=class extends Error{constructor(r){super(ae(1)),this.value=r}},ar=class extends Error{constructor(e){super(ae(5)),this.value=e}},sr=class{constructor(r,n){this.value=r,this.replacement=n}},ir=()=>{let e={p:0,s:0,f:0};return e.p=new Promise((r,n)=>{e.s=r,e.f=n}),e},ur=(e,r)=>{e.s(r),e.p.s=1,e.p.v=r},or=(e,r)=>{e.f(r),e.p.s=2,e.p.v=r};ir.toString();ur.toString();or.toString();var cr=()=>{let e=[],r=[],n=!0,a=!1,s=0,i=(o,p,d)=>{for(d=0;d<s;d++)r[d]&&r[d][p](o)},u=(o,p,d,y)=>{for(p=0,d=e.length;p<d;p++)y=e[p],!n&&p===d-1?o[a?"return":"throw"](y):o.next(y)},l=(o,p)=>(n&&(p=s++,r[p]=o),u(o),()=>{n&&(r[p]=r[s],r[s--]=void 0)});return{__SEROVAL_STREAM__:!0,on:o=>l(o),next:o=>{n&&(e.push(o),i(o,"next"))},throw:o=>{n&&(e.push(o),i(o,"throw"),n=!1,a=!1,r.length=0)},return:o=>{n&&(e.push(o),i(o,"return"),n=!1,a=!0,r.length=0)}}},lr=e=>{let r=atob(e),n=r.length,a=new Uint8Array(n);for(let s=0;s<n;s++)a[s]=r.charCodeAt(s);return a.buffer};lr.toString();function fr(e){return"__SEROVAL_SEQUENCE__"in e}function pr(e,r,n){return{__SEROVAL_SEQUENCE__:!0,v:e,t:r,d:n}}function dr(e){let r=[],n=-1,a=-1,s=e[E]();for(;;)try{let i=s.next();if(r.push(i.value),i.done){a=r.length-1;break}}catch(i){n=r.length,r.push(i)}return pr(r,n,a)}var yr={},hr={},br={0:{},1:{},2:{},3:{},4:{},5:{}};function wr(e){return"__SEROVAL_STREAM__"in e}function N(){return cr()}function mr(e){let r=N(),n=e[g]();async function a(){try{let s=await n.next();s.done?r.return(s.value):(r.next(s.value),await a())}catch(s){r.throw(s)}}return a().catch(()=>{}),r}async function vr(e){try{return[1,await e]}catch(r){return[0,r]}}function gr(e,r){return{plugins:r.plugins,mode:e,marked:new Set,features:63^(r.disabledFeatures||0),refs:r.refs||new Map,depthLimit:r.depthLimit||1e3}}function U(e,r){e.marked.add(r)}function Er(e,r){let n=e.refs.size;return e.refs.set(r,n),n}function O(e,r){let n=e.refs.get(r);return n!=null?(U(e,n),{type:1,value:Pe(n)}):{type:0,value:Er(e,r)}}function j(e,r){let n=O(e,r);return n.type===1?n:ee(r)?{type:2,value:ke(n.value,r)}:n}function v(e,r){let n=j(e,r);if(n.type!==0)return n.value;if(r in W)return Le(n.value,r);throw new $(r)}function _(e,r){let n=O(e,br[r]);return n.type===1?n.value:c(26,n.value,r,t,t,t,t,t,t,t,t,t)}function zr(e){let r=O(e,yr);return r.type===1?r.value:c(27,r.value,t,t,t,t,t,t,v(e,E),t,t,t)}function Rr(e){let r=O(e,hr);return r.type===1?r.value:c(29,r.value,t,t,t,t,t,[_(e,1),v(e,g)],t,t,t,t)}function Sr(e,r,n,a){return c(n?11:10,e,t,t,t,a,t,t,t,t,te(r),t)}function xr(e,r,n,a){return c(8,r,t,t,t,t,{k:n,v:a},t,_(e,0),t,t,t)}function Ar(e,r,n){let a=new Uint8Array(n),s="";for(let i=0,u=a.length;i<u;i++)s+=String.fromCharCode(a[i]);return c(19,r,m(btoa(s)),t,t,t,t,t,_(e,5),t,t,t)}function Ur(e,r){return{base:gr(e,r),child:void 0}}var $r=class{constructor(e,r){this._p=e,this.depth=r}parse(e){return f(this._p,this.depth,e)}};async function Or(e,r,n){let a=[];for(let s=0,i=n.length;s<i;s++)s in n?a[s]=await f(e,r,n[s]):a[s]=0;return a}async function _r(e,r,n,a){return je(n,a,await Or(e,r,a))}async function M(e,r,n){let a=Object.entries(n),s=[],i=[];for(let u=0,l=a.length;u<l;u++)s.push(m(a[u][0])),i.push(await f(e,r,a[u][1]));return E in n&&(s.push(v(e.base,E)),i.push(Ye(zr(e.base),await f(e,r,dr(n))))),g in n&&(s.push(v(e.base,g)),i.push(He(Rr(e.base),await f(e,r,mr(n))))),A in n&&(s.push(v(e.base,A)),i.push(ne(n[A]))),x in n&&(s.push(v(e.base,x)),i.push(n[x]?Q:K)),{k:s,v:i}}async function C(e,r,n,a,s){return Sr(n,a,s,await M(e,r,a))}async function Cr(e,r,n,a){return Me(n,await f(e,r,a.valueOf()))}async function Ir(e,r,n,a){return De(n,a,await f(e,r,a.buffer))}async function Pr(e,r,n,a){return Be(n,a,await f(e,r,a.buffer))}async function Tr(e,r,n,a){return Ve(n,a,await f(e,r,a.buffer))}async function q(e,r,n,a){let s=re(a,e.base.features);return qe(n,a,s?await M(e,r,s):t)}async function Fr(e,r,n,a){let s=re(a,e.base.features);return Xe(n,a,s?await M(e,r,s):t)}async function Lr(e,r,n,a){let s=[],i=[];for(let[u,l]of a.entries())s.push(await f(e,r,u)),i.push(await f(e,r,l));return xr(e.base,n,s,i)}async function kr(e,r,n,a){let s=[];for(let i of a.keys())s.push(await f(e,r,i));return Ge(n,s)}async function se(e,r,n,a){let s=e.base.plugins;if(s)for(let i=0,u=s.length;i<u;i++){let l=s[i];if(l.parse.async&&l.test(a))return Ne(n,l.tag,await l.parse.async(a,new $r(e,r),{id:n}))}return t}async function Nr(e,r,n,a){let[s,i]=await vr(a);return c(12,n,s,t,t,t,t,t,await f(e,r,i),t,t,t)}function jr(e,r,n,a,s){let i=[],u=n.on({next:l=>{U(this.base,r),f(this,e,l).then(o=>{i.push(We(r,o))},o=>{s(o),u()})},throw:l=>{U(this.base,r),f(this,e,l).then(o=>{i.push(Qe(r,o)),a(i),u()},o=>{s(o),u()})},return:l=>{U(this.base,r),f(this,e,l).then(o=>{i.push(Ke(r,o)),a(i),u()},o=>{s(o),u()})}})}async function Mr(e,r,n,a){return Je(n,_(e.base,4),await new Promise(jr.bind(e,r,n,a)))}async function Dr(e,r,n,a){let s=[];for(let i=0,u=a.v.length;i<u;i++)s[i]=await f(e,r,a.v[i]);return Ze(n,s,a.t,a.d)}async function Br(e,r,n,a){if(Array.isArray(a))return _r(e,r,n,a);if(wr(a))return Mr(e,r,n,a);if(fr(a))return Dr(e,r,n,a);let s=a.constructor;if(s===sr)return f(e,r,a.replacement);let i=await se(e,r,n,a);if(i)return i;switch(s){case Object:return C(e,r,n,a,!1);case t:return C(e,r,n,a,!0);case Date:return Te(n,a);case Error:case EvalError:case RangeError:case ReferenceError:case SyntaxError:case TypeError:case URIError:return q(e,r,n,a);case Number:case Boolean:case String:case BigInt:return Cr(e,r,n,a);case ArrayBuffer:return Ar(e.base,n,a);case Int8Array:case Int16Array:case Int32Array:case Uint8Array:case Uint16Array:case Uint32Array:case Uint8ClampedArray:case Float32Array:case Float64Array:return Ir(e,r,n,a);case DataView:return Tr(e,r,n,a);case Map:return Lr(e,r,n,a);case Set:return kr(e,r,n,a)}if(s===Promise||a instanceof Promise)return Nr(e,r,n,a);let u=e.base.features;if(u&32&&s===RegExp)return Fe(n,a);if(u&16)switch(s){case BigInt64Array:case BigUint64Array:return Pr(e,r,n,a)}if(u&1&&typeof AggregateError<"u"&&(s===AggregateError||a instanceof AggregateError))return Fr(e,r,n,a);if(a instanceof Error)return q(e,r,n,a);if(E in a||g in a)return C(e,r,n,a,!!s);throw new $(a)}async function Vr(e,r,n){let a=j(e.base,n);if(a.type!==0)return a.value;let s=await se(e,r,a.value,n);if(s)return s;throw new $(n)}async function f(e,r,n){switch(typeof n){case"boolean":return n?Q:K;case"undefined":return ze;case"string":return ne(n);case"number":return Ce(n);case"bigint":return Ie(n);case"object":{if(n){let a=j(e.base,n);return a.type===0?await Br(e,r+1,a.value,n):a.value}return Re}case"symbol":return v(e.base,n);case"function":return Vr(e,r,n);default:throw new $(n)}}async function qr(e,r){try{return await f(e,0,r)}catch(n){throw n instanceof V?n:new V(n)}}var Xr=(e=>(e[e.Vanilla=1]="Vanilla",e[e.Cross=2]="Cross",e))(Xr||{});function ie(e,r){for(let n=0,a=r.length;n<a;n++){let s=r[n];e.has(s)||(e.add(s),s.extends&&ie(e,s.extends))}}function Gr(e){if(e){let r=new Set;return ie(r,e),[...r]}}var Yr=()=>T;Yr.toString();function Hr(e){return(0,eval)(e)}async function ue(e,r={}){let n=Gr(r.plugins),a=Ur(1,{plugins:n,disabledFeatures:r.disabledFeatures});return{t:await qr(a,e),f:a.base.features,m:Array.from(a.base.marked)}}function I(e){return{detail:e.detail,bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed}}var Jr={tag:"seroval-plugins/web/CustomEvent",test(e){return typeof CustomEvent>"u"?!1:e instanceof CustomEvent},parse:{sync(e,r){return{type:r.parse(e.type),options:r.parse(I(e))}},async async(e,r){return{type:await r.parse(e.type),options:await r.parse(I(e))}},stream(e,r){return{type:r.parse(e.type),options:r.parse(I(e))}}},serialize(e,r){return"new CustomEvent("+r.serialize(e.type)+","+r.serialize(e.options)+")"},deserialize(e,r){return new CustomEvent(r.deserialize(e.type),r.deserialize(e.options))}},Wr=Jr,Qr={tag:"seroval-plugins/web/DOMException",test(e){return typeof DOMException>"u"?!1:e instanceof DOMException},parse:{sync(e,r){return{name:r.parse(e.name),message:r.parse(e.message)}},async async(e,r){return{name:await r.parse(e.name),message:await r.parse(e.message)}},stream(e,r){return{name:r.parse(e.name),message:r.parse(e.message)}}},serialize(e,r){return"new DOMException("+r.serialize(e.message)+","+r.serialize(e.name)+")"},deserialize(e,r){return new DOMException(r.deserialize(e.message),r.deserialize(e.name))}},Kr=Qr;function P(e){return{bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed}}var Zr={tag:"seroval-plugins/web/Event",test(e){return typeof Event>"u"?!1:e instanceof Event},parse:{sync(e,r){return{type:r.parse(e.type),options:r.parse(P(e))}},async async(e,r){return{type:await r.parse(e.type),options:await r.parse(P(e))}},stream(e,r){return{type:r.parse(e.type),options:r.parse(P(e))}}},serialize(e,r){return"new Event("+r.serialize(e.type)+","+r.serialize(e.options)+")"},deserialize(e,r){return new Event(r.deserialize(e.type),r.deserialize(e.options))}},et=Zr,rt={tag:"seroval-plugins/web/File",test(e){return typeof File>"u"?!1:e instanceof File},parse:{async async(e,r){return{name:await r.parse(e.name),options:await r.parse({type:e.type,lastModified:e.lastModified}),buffer:await r.parse(await e.arrayBuffer())}}},serialize(e,r){return"new File(["+r.serialize(e.buffer)+"],"+r.serialize(e.name)+","+r.serialize(e.options)+")"},deserialize(e,r){return new File([r.deserialize(e.buffer)],r.deserialize(e.name),r.deserialize(e.options))}},tt=rt;function F(e){let r=[];return e.forEach((n,a)=>{r.push([a,n])}),r}var h={},oe=(e,r=new FormData,n=0,a=e.length,s)=>{for(;n<a;n++)s=e[n],r.append(s[0],s[1]);return r},nt={tag:"seroval-plugins/web/FormDataFactory",test(e){return e===h},parse:{sync(){return h},async async(){return await Promise.resolve(h)},stream(){return h}},serialize(){return oe.toString()},deserialize(){return h}},at={tag:"seroval-plugins/web/FormData",extends:[tt,nt],test(e){return typeof FormData>"u"?!1:e instanceof FormData},parse:{sync(e,r){return{factory:r.parse(h),entries:r.parse(F(e))}},async async(e,r){return{factory:await r.parse(h),entries:await r.parse(F(e))}},stream(e,r){return{factory:r.parse(h),entries:r.parse(F(e))}}},serialize(e,r){return"("+r.serialize(e.factory)+")("+r.serialize(e.entries)+")"},deserialize(e,r){return oe(r.deserialize(e.entries))}},st=at;function L(e){let r=[];return e.forEach((n,a)=>{r.push([a,n])}),r}var it={tag:"seroval-plugins/web/Headers",test(e){return typeof Headers>"u"?!1:e instanceof Headers},parse:{sync(e,r){return{value:r.parse(L(e))}},async async(e,r){return{value:await r.parse(L(e))}},stream(e,r){return{value:r.parse(L(e))}}},serialize(e,r){return"new Headers("+r.serialize(e.value)+")"},deserialize(e,r){return new Headers(r.deserialize(e.value))}},D=it,b={},ce=e=>new ReadableStream({start:r=>{e.on({next:n=>{try{r.enqueue(n)}catch{}},throw:n=>{r.error(n)},return:()=>{try{r.close()}catch{}}})}}),ut={tag:"seroval-plugins/web/ReadableStreamFactory",test(e){return e===b},parse:{sync(){return b},async async(){return await Promise.resolve(b)},stream(){return b}},serialize(){return ce.toString()},deserialize(){return b}};function X(e){let r=N(),n=e.getReader();async function a(){try{let s=await n.read();s.done?r.return(s.value):(r.next(s.value),await a())}catch(s){r.throw(s)}}return a().catch(()=>{}),r}var ot={tag:"seroval/plugins/web/ReadableStream",extends:[ut],test(e){return typeof ReadableStream>"u"?!1:e instanceof ReadableStream},parse:{sync(e,r){return{factory:r.parse(b),stream:r.parse(N())}},async async(e,r){return{factory:await r.parse(b),stream:await r.parse(X(e))}},stream(e,r){return{factory:r.parse(b),stream:r.parse(X(e))}}},serialize(e,r){return"("+r.serialize(e.factory)+")("+r.serialize(e.stream)+")"},deserialize(e,r){let n=r.deserialize(e.stream);return ce(n)}},B=ot;function G(e,r){return{body:r,cache:e.cache,credentials:e.credentials,headers:e.headers,integrity:e.integrity,keepalive:e.keepalive,method:e.method,mode:e.mode,redirect:e.redirect,referrer:e.referrer,referrerPolicy:e.referrerPolicy}}var ct={tag:"seroval-plugins/web/Request",extends:[B,D],test(e){return typeof Request>"u"?!1:e instanceof Request},parse:{async async(e,r){return{url:await r.parse(e.url),options:await r.parse(G(e,e.body&&!e.bodyUsed?await e.clone().arrayBuffer():null))}},stream(e,r){return{url:r.parse(e.url),options:r.parse(G(e,e.body&&!e.bodyUsed?e.clone().body:null))}}},serialize(e,r){return"new Request("+r.serialize(e.url)+","+r.serialize(e.options)+")"},deserialize(e,r){return new Request(r.deserialize(e.url),r.deserialize(e.options))}},lt=ct;function Y(e){return{headers:e.headers,status:e.status,statusText:e.statusText}}var ft={tag:"seroval-plugins/web/Response",extends:[B,D],test(e){return typeof Response>"u"?!1:e instanceof Response},parse:{async async(e,r){return{body:await r.parse(e.body&&!e.bodyUsed?await e.clone().arrayBuffer():null),options:await r.parse(Y(e))}},stream(e,r){return{body:r.parse(e.body&&!e.bodyUsed?e.clone().body:null),options:r.parse(Y(e))}}},serialize(e,r){return"new Response("+r.serialize(e.body)+","+r.serialize(e.options)+")"},deserialize(e,r){return new Response(r.deserialize(e.body),r.deserialize(e.options))}},pt=ft,dt={tag:"seroval-plugins/web/URL",test(e){return typeof URL>"u"?!1:e instanceof URL},parse:{sync(e,r){return{value:r.parse(e.href)}},async async(e,r){return{value:await r.parse(e.href)}},stream(e,r){return{value:r.parse(e.href)}}},serialize(e,r){return"new URL("+r.serialize(e.value)+")"},deserialize(e,r){return new URL(r.deserialize(e.value))}},yt=dt,ht={tag:"seroval-plugins/web/URLSearchParams",test(e){return typeof URLSearchParams>"u"?!1:e instanceof URLSearchParams},parse:{sync(e,r){return{value:r.parse(e.toString())}},async async(e,r){return{value:await r.parse(e.toString())}},stream(e,r){return{value:r.parse(e.toString())}}},serialize(e,r){return"new URLSearchParams("+r.serialize(e.value)+")"},deserialize(e,r){return new URLSearchParams(r.deserialize(e.value))}},bt=ht;class wt{reader;buffer;done;constructor(r){this.reader=r.getReader(),this.buffer=new Uint8Array(0),this.done=!1}async readChunk(){const r=await this.reader.read();if(r.done)this.done=!0;else{let n=new Uint8Array(this.buffer.length+r.value.length);n.set(this.buffer),n.set(r.value,this.buffer.length),this.buffer=n}}async next(){if(this.buffer.length===0)return this.done?{done:!0,value:void 0}:(await this.readChunk(),await this.next());const r=new TextDecoder().decode(this.buffer.subarray(1,11)),n=Number.parseInt(r,16);if(Number.isNaN(n))throw new Error(`Malformed server function stream header: ${r}`);for(;n>this.buffer.length-12;){if(this.done)throw new Error("Malformed server function stream.");await this.readChunk()}const a=new TextDecoder().decode(this.buffer.subarray(12,12+n));return this.buffer=this.buffer.subarray(12+n),{done:!1,value:Hr(a)}}async drain(){for(;!(await this.next()).done;);}}async function H(e,r){if(!r.body)throw new Error("missing body");const n=new wt(r.body),a=await n.next();return a.done||n.drain().then(()=>{delete $R[e]},()=>{}),a.value}let mt=0;function S(e,r,n,a){return fetch(e,{method:"POST",...a,headers:{...a.headers,"X-Server-Id":r,"X-Server-Instance":n}})}const le=[Wr,Kr,et,st,D,B,lt,pt,bt,yt];async function J(e,r,n,a){const s=`server-fn:${mt++}`,i=await(a.length===0?S(e,r,s,n):a.length===1&&a[0]instanceof FormData?S(e,r,s,{...n,body:a[0]}):a.length===1&&a[0]instanceof URLSearchParams?S(e,r,s,{...n,body:a[0],headers:{...n.headers,"Content-Type":"application/x-www-form-urlencoded"}}):S(e,r,s,{...n,body:JSON.stringify(await Promise.resolve(ue(a,{plugins:le}))),headers:{...n.headers,"Content-Type":"application/json"}}));if(i.headers.has("Location")||i.headers.has("X-Revalidate")||i.headers.has("X-Single-Flight"))return i.body&&(i.customBody=()=>H(s,i)),i;const u=i.headers.get("Content-Type");let l;if(u&&u.startsWith("text/plain")?l=await i.text():u&&u.startsWith("application/json")?l=await i.json():l=await H(s,i),i.headers.has("X-Error"))throw l;return l}function Et(e,r,n){return new Proxy(e,{get(s,i,u){if(i==="url")return`/_server?id=${encodeURIComponent(r)}&name=${encodeURIComponent(n)}`;if(i==="GET")return u.withOptions({method:"GET"});if(i==="withOptions"){const l=`/_server/?id=${encodeURIComponent(r)}&name=${encodeURIComponent(n)}`;return o=>{const p=async(...d)=>{const y=o.method&&o.method.toUpperCase()==="GET";return J(y?l+(d.length?`&args=${encodeURIComponent(JSON.stringify(await Promise.resolve(ue(d,{plugins:le}))))}`:""):"/_server",`${r}#${n}`,o,y?[]:d)};return p.url=l,p}}return s[i]},apply(s,i,u){return J("/_server",`${r}#${n}`,{},u)}})}export{Et as c};
